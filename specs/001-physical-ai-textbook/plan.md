# Implementation Plan: Physical AI & Humanoid Robotics Textbook

**Branch**: `001-physical-ai-textbook` | **Date**: 2025-12-05 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-physical-ai-textbook/spec.md`

## Summary

Build a complete textbook website for Physical AI & Humanoid Robotics using Docusaurus v3.5.2 with:
- 100+ AI-generated lessons across 4 Parts and 17 Chapters
- Full Urdu translation with RTL support
- Authentication-gated premium features (ChatKit RAG bot, Urdu switcher, personalized tips)
- Navy blue + black glassmorphism design
- 25+ Claude subagents with individual commits
- Zero-error deployment to Vercel

## Technical Context

**Language/Version**: TypeScript 5.x (Docusaurus), Python 3.11 (FastAPI backend)
**Primary Dependencies**: Docusaurus 3.5.2, Tailwind CSS, React 18, FastAPI, Qdrant, OpenAI
**Storage**: Neon PostgreSQL (serverless), Qdrant Cloud (vectors)
**Testing**: Pytest (backend), Playwright (E2E)
**Target Platform**: Web (Vercel deployment)
**Project Type**: Web application (frontend + backend)
**Performance Goals**: Lighthouse >80, page load <3s, ChatKit response <5s
**Constraints**: No external translation APIs, custom auth only, Docusaurus-only architecture
**Scale/Scope**: 100+ lessons, 30+ diagrams, unlimited users (serverless scaling)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Docusaurus-Only Architecture | ‚úÖ PASS | Docusaurus 3.5.2 with Tailwind via PostCSS integration |
| II. AI-Generated Content Mandate | ‚úÖ PASS | 26 subagents defined for all content generation |
| III. Authentication-Gated Premium Features | ‚úÖ PASS | Custom JWT auth, gated ChatKit/Urdu/Tips |
| IV. User Data Collection Requirements | ‚úÖ PASS | Level dropdown + hardware text field in signup |
| V. Design System Compliance | ‚úÖ PASS | Navy blue #001F3F, black, glassmorphism defined |
| VI. Zero-Error Deployment Standard | ‚úÖ PASS | Testing phase with Playwright E2E |
| VII. Accessibility and Internationalization | ‚úÖ PASS | Built-in i18n, alt text requirements, RTL support |
| VIII. Performance and Security | ‚úÖ PASS | Lighthouse target, JWT auth, env vars for secrets |

## Project Structure

### Documentation (this feature)

```text
specs/001-physical-ai-textbook/
‚îú‚îÄ‚îÄ plan.md              # This file
‚îú‚îÄ‚îÄ research.md          # Technology decisions
‚îú‚îÄ‚îÄ data-model.md        # Database schema
‚îú‚îÄ‚îÄ quickstart.md        # Developer setup guide
‚îú‚îÄ‚îÄ contracts/           # API specifications
‚îÇ   ‚îî‚îÄ‚îÄ openapi.yaml     # REST API contract
‚îî‚îÄ‚îÄ tasks.md             # Generated by /sp.tasks
```

### Source Code (repository root)

```text
textbook/                          # Docusaurus project root
‚îú‚îÄ‚îÄ docusaurus.config.ts           # Main configuration
‚îú‚îÄ‚îÄ package.json                   # pnpm dependencies
‚îú‚îÄ‚îÄ tailwind.config.js             # Tailwind configuration
‚îú‚îÄ‚îÄ postcss.config.js              # PostCSS for Tailwind
‚îú‚îÄ‚îÄ tsconfig.json                  # TypeScript config
‚îÇ
‚îú‚îÄ‚îÄ docs/                          # English content
‚îÇ   ‚îú‚îÄ‚îÄ part1/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ _category_.json
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chapter1/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ _category_.json
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lesson1.md
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lesson2.md
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ... (5 lessons)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ... (4 chapters)
‚îÇ   ‚îú‚îÄ‚îÄ part2/                     # 4 chapters √ó 6 lessons
‚îÇ   ‚îú‚îÄ‚îÄ part3/                     # 5 chapters √ó 5 lessons
‚îÇ   ‚îî‚îÄ‚îÄ part4/                     # 4 chapters √ó 7 lessons
‚îÇ
‚îú‚îÄ‚îÄ i18n/
‚îÇ   ‚îî‚îÄ‚îÄ ur/
‚îÇ       ‚îî‚îÄ‚îÄ docusaurus-plugin-content-docs/
‚îÇ           ‚îî‚îÄ‚îÄ current/           # Urdu mirror of docs/
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatKitPanel.tsx       # Floating chat panel
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PersonalizeTips.tsx    # Tips overlay
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LanguageSwitcher.tsx   # Premium language toggle
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthProvider.tsx       # Auth context
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PremiumGate.tsx        # Auth-gated wrapper
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Toast.tsx              # Toast notifications
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ErrorBoundary.tsx      # Error handling
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ custom.css             # Tailwind + glassmorphism
‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.tsx              # Landing page
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login.tsx              # Login page
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ signup.tsx             # Signup page
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ profile.tsx            # User profile
‚îÇ   ‚îî‚îÄ‚îÄ theme/
‚îÇ       ‚îú‚îÄ‚îÄ Navbar/                # Custom navbar
‚îÇ       ‚îî‚îÄ‚îÄ Footer/                # Custom footer
‚îÇ
‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îî‚îÄ‚îÄ img/
‚îÇ       ‚îú‚îÄ‚îÄ book-cover.png         # 1200√ó630 cover
‚îÇ       ‚îú‚îÄ‚îÄ logo.png               # Site logo
‚îÇ       ‚îî‚îÄ‚îÄ diagrams/              # 30+ lesson diagrams
‚îÇ
‚îî‚îÄ‚îÄ backend/
    ‚îú‚îÄ‚îÄ app/
    ‚îÇ   ‚îú‚îÄ‚îÄ main.py                # FastAPI app
    ‚îÇ   ‚îú‚îÄ‚îÄ auth.py                # JWT authentication
    ‚îÇ   ‚îú‚îÄ‚îÄ chat.py                # ChatKit RAG logic
    ‚îÇ   ‚îú‚îÄ‚îÄ tips.py                # Personalization logic
    ‚îÇ   ‚îî‚îÄ‚îÄ models.py              # Pydantic models
    ‚îú‚îÄ‚îÄ db/
    ‚îÇ   ‚îú‚îÄ‚îÄ schema.sql             # Neon schema
    ‚îÇ   ‚îî‚îÄ‚îÄ connection.py          # Database connection
    ‚îî‚îÄ‚îÄ tests/
        ‚îú‚îÄ‚îÄ test_auth.py           # Auth tests
        ‚îî‚îÄ‚îÄ test_chat.py           # ChatKit tests
```

**Structure Decision**: Web application with Docusaurus frontend and FastAPI backend. Backend deployed as Vercel serverless functions via `/api` routes.

## Implementation Phases

### Phase 1: Clean Docusaurus + Tailwind Install

**Goal**: Initialize a working Docusaurus 3.5.2 project with Tailwind CSS and glassmorphism styling.

**Subagents**:
1. **DocusaurusSetupAgent**: Initialize Docusaurus with TypeScript
2. **TailwindConfigAgent**: Configure Tailwind CSS with PostCSS
3. **ProjectStructureAgent**: Create folder structure and base files

**Tasks**:
```bash
# DocusaurusSetupAgent
npx create-docusaurus@3.5.2 textbook classic --typescript
cd textbook
rm -rf node_modules package-lock.json
pnpm install

# TailwindConfigAgent
pnpm add -D tailwindcss postcss autoprefixer
npx tailwindcss init -p
# Configure tailwind.config.js for Docusaurus paths
# Add Tailwind directives to custom.css

# ProjectStructureAgent
# Create src/components/, src/pages/, backend/, static/img/ directories
```

**Error Handling**:
- If npm/pnpm conflict: Delete node_modules, clear cache, reinstall
- If Tailwind not loading: Check postcss.config.js paths
- If build fails: Verify docusaurus.config.ts syntax

**Deliverables**:
- [ ] Docusaurus 3.5.2 running on localhost:3000
- [ ] Tailwind CSS working with glassmorphism classes
- [ ] Navy blue (#001F3F) theme configured
- [ ] Folder structure created

**Commit**: `Subagent [DocusaurusSetupAgent]: Initialize Docusaurus 3.5.2 with TypeScript`
**Commit**: `Subagent [TailwindConfigAgent]: Configure Tailwind CSS with glassmorphism`
**Commit**: `Subagent [ProjectStructureAgent]: Create project folder structure`

---

### Phase 2: Generate Cover + Logo + 30 Diagrams

**Goal**: Create all visual assets needed for the textbook.

**Subagents**:
4. **CoverImageAgent**: Generate book cover (1200√ó630 PNG)
5. **LogoAgent**: Generate logo and favicon
6. **DiagramAgent**: Generate 30+ technical diagrams

**Tasks**:
```
# CoverImageAgent
- Generate futuristic robotics cover with DALL-E 3
- Prompt: "Modern textbook cover for Physical AI and Humanoid Robotics, navy blue theme, futuristic robot, clean professional design, 1200x630"
- Save to static/img/book-cover.png

# LogoAgent
- Generate simple logo icon
- Create favicon.ico
- Save to static/img/logo.png

# DiagramAgent
- Generate diagrams for each chapter concept
- Use Mermaid.js for flowcharts/architecture
- Use SVG generation for technical illustrations
- Naming: diagram-p{part}-c{chapter}-l{lesson}.svg
```

**Error Handling**:
- If DALL-E fails: Retry with simplified prompt, use placeholder
- If SVG generation fails: Use Mermaid.js fallback
- Ensure all images have descriptive filenames for alt text

**Deliverables**:
- [ ] book-cover.png (1200√ó630)
- [ ] logo.png and favicon
- [ ] 30+ diagrams in static/img/diagrams/
- [ ] All images with proper alt text metadata

**Commit**: `Subagent [CoverImageAgent]: Generate book cover image`
**Commit**: `Subagent [LogoAgent]: Generate logo and favicon`
**Commit**: `Subagent [DiagramAgent]: Generate 30+ technical diagrams`

---

### Phase 3: Generate Full English Book (100+ Lessons)

**Goal**: Generate all textbook content in English with proper structure.

**Subagents**:
7. **Part1ContentAgent**: Generate Part 1 - Introduction to Physical AI (4 chapters √ó 5 lessons = 20)
8. **Part2ContentAgent**: Generate Part 2 - Humanoid Robotics Fundamentals (4 chapters √ó 6 lessons = 24)
9. **Part3ContentAgent**: Generate Part 3 - Sensors and Perception (5 chapters √ó 5 lessons = 25)
10. **Part4ContentAgent**: Generate Part 4 - Advanced Applications (4 chapters √ó 7 lessons = 28)
11. **MCQAgent**: Generate 10 MCQs per lesson (970+ questions total)

**Content Structure Per Lesson**:
```markdown
---
sidebar_position: {N}
title: "{Lesson Title}"
description: "{SEO description}"
---

# {Lesson Title}

## Recap
- {Point 1 from previous lesson}
- {Point 2 from previous lesson}
- {Point 3 from previous lesson}

{800-1200 words of content}

### Code Example
```python
# Practical code example
```

### Activity 1: {Hands-on task}
{Activity description}

### Activity 2: {Second task if applicable}

![{Diagram description}](/img/diagrams/diagram-p{P}-c{C}-l{L}.svg)

<details>
<summary>üìù Quiz: Test Your Knowledge</summary>

{10 MCQs with answers}

</details>

---
[‚Üê Previous](./lesson{L-1}.md) | [Next ‚Üí](./lesson{L+1}.md)
```

**Book Outline**:

**Part 1: Introduction to Physical AI** (20 lessons)
- Chapter 1: What is Physical AI? (5 lessons)
- Chapter 2: History of Robotics (5 lessons)
- Chapter 3: Types of Robots (5 lessons)
- Chapter 4: AI in Physical Systems (5 lessons)

**Part 2: Humanoid Robotics Fundamentals** (24 lessons)
- Chapter 1: Human Anatomy for Roboticists (6 lessons)
- Chapter 2: Kinematics and Motion (6 lessons)
- Chapter 3: Actuators and Motors (6 lessons)
- Chapter 4: Power Systems (6 lessons)

**Part 3: Sensors and Perception** (25 lessons)
- Chapter 1: Vision Systems (5 lessons)
- Chapter 2: Touch and Haptics (5 lessons)
- Chapter 3: Audio Processing (5 lessons)
- Chapter 4: Proprioception (5 lessons)
- Chapter 5: Sensor Fusion (5 lessons)

**Part 4: Advanced Applications** (28 lessons)
- Chapter 1: Locomotion and Balance (7 lessons)
- Chapter 2: Manipulation and Grasping (7 lessons)
- Chapter 3: Human-Robot Interaction (7 lessons)
- Chapter 4: Real-World Deployment (7 lessons)

**Error Handling**:
- If content too short (<800 words): Re-generate with explicit word count
- If code examples missing: Add placeholder, flag for review
- If diagram reference broken: Use fallback placeholder image

**Deliverables**:
- [ ] 97 lesson files in docs/
- [ ] _category_.json for all parts and chapters
- [ ] All lessons following content template
- [ ] 970+ MCQs embedded in lessons

**Commit**: `Subagent [Part1ContentAgent]: Generate Part 1 lessons (20 files)`
**Commit**: `Subagent [Part2ContentAgent]: Generate Part 2 lessons (24 files)`
**Commit**: `Subagent [Part3ContentAgent]: Generate Part 3 lessons (25 files)`
**Commit**: `Subagent [Part4ContentAgent]: Generate Part 4 lessons (28 files)`
**Commit**: `Subagent [MCQAgent]: Add MCQs to all lessons`

---

### Phase 4: Generate Urdu i18n Mirror

**Goal**: Create complete Urdu translation of all content with RTL support.

**Subagents**:
12. **UrduTranslationAgent**: Translate all 97+ lessons to Urdu
13. **RTLConfigAgent**: Configure RTL layout and Noto Nastaliq Urdu font

**Tasks**:
```
# UrduTranslationAgent
- Mirror docs/ structure to i18n/ur/docusaurus-plugin-content-docs/current/
- Translate each lesson maintaining markdown structure
- Keep code blocks in English
- Translate UI strings (sidebar, navigation)

# RTLConfigAgent
- Add Noto Nastaliq Urdu font to custom.css
- Configure Docusaurus i18n in docusaurus.config.ts
- Add RTL CSS rules for Urdu locale
```

**i18n Configuration**:
```typescript
// docusaurus.config.ts
i18n: {
  defaultLocale: 'en',
  locales: ['en', 'ur'],
  localeConfigs: {
    en: { label: 'English', direction: 'ltr' },
    ur: { label: 'ÿßÿ±ÿØŸà', direction: 'rtl' },
  },
},
```

**Error Handling**:
- If translation quality poor: Re-generate with more context
- If RTL layout breaks: Test each component, add CSS fixes
- If font not loading: Check Google Fonts import, add fallback

**Deliverables**:
- [ ] Complete i18n/ur/ directory structure
- [ ] 97+ translated lesson files
- [ ] RTL stylesheet working
- [ ] Noto Nastaliq Urdu font integrated

**Commit**: `Subagent [UrduTranslationAgent]: Translate all lessons to Urdu`
**Commit**: `Subagent [RTLConfigAgent]: Configure RTL and Urdu font`

---

### Phase 5: Build Responsive Navbar + Footer

**Goal**: Create custom responsive navbar and footer with auth-aware elements.

**Subagents**:
14. **NavbarAgent**: Build responsive navbar with logo, title, GitHub, theme toggle, and conditional language switcher
15. **FooterAgent**: Build responsive footer with links and credits

**Navbar Requirements**:
- Left: Logo + "Izma's Textbook" title
- Right: GitHub icon, theme toggle
- Right (authenticated only): Language switcher
- Mobile: Hamburger menu

**Footer Requirements**:
- Copyright notice
- Links to Parts 1-4
- "Built with Docusaurus" credit
- Social links

**Error Handling**:
- If navbar items overlap: Adjust breakpoints, test all sizes
- If theme toggle breaks: Check Docusaurus colorMode config
- If hamburger menu stuck: Debug event handlers

**Deliverables**:
- [ ] Custom Navbar component in src/theme/Navbar/
- [ ] Custom Footer component in src/theme/Footer/
- [ ] Mobile-responsive at all breakpoints (320px-2560px)
- [ ] Auth-aware language switcher visibility

**Commit**: `Subagent [NavbarAgent]: Build responsive navbar with auth awareness`
**Commit**: `Subagent [FooterAgent]: Build responsive footer`

---

### Phase 6: Better Auth + Signup Questions Page

**Goal**: Implement custom authentication with level and hardware questions.

**Subagents**:
16. **SignupPageAgent**: Create signup page with email, password, level dropdown, hardware text field
17. **LoginPageAgent**: Create login page
18. **AuthContextAgent**: Implement React auth context with JWT handling

**Signup Form Fields**:
1. Email (required, validated)
2. Password (required, min 8 chars)
3. Level (required dropdown): Beginner / Intermediate / Advanced
4. Hardware Access (optional text, max 500 chars)

**Auth Flow**:
1. User submits signup ‚Üí API validates ‚Üí JWT returned
2. JWT stored in httpOnly cookie
3. AuthProvider reads cookie, provides user context
4. Protected components check auth state

**Error Handling**:
- If email exists: Show "Email already registered" error
- If password weak: Show validation requirements
- If API unreachable: Show "Network error, try again" toast
- If token expired: Clear auth state, redirect to login

**Deliverables**:
- [ ] src/pages/signup.tsx with all fields
- [ ] src/pages/login.tsx
- [ ] src/components/AuthProvider.tsx
- [ ] Toast notifications for auth errors
- [ ] Redirect after successful login

**Commit**: `Subagent [SignupPageAgent]: Create signup page with preference questions`
**Commit**: `Subagent [LoginPageAgent]: Create login page`
**Commit**: `Subagent [AuthContextAgent]: Implement auth context and JWT handling`

---

### Phase 7: Neon DB + user_prefs Table

**Goal**: Set up Neon PostgreSQL database with schema and API endpoints.

**Subagents**:
19. **NeonSchemaAgent**: Create database schema and migrations
20. **APIRoutesAgent**: Implement FastAPI endpoints for auth and user management

**Database Schema** (from data-model.md):
- users (id, email, password_hash, created_at, updated_at)
- user_prefs (user_id, level, hardware_access, updated_at)
- chat_sessions (id, user_id, created_at)
- chat_messages (id, session_id, role, content, context_used, created_at)

**API Endpoints** (from contracts/openapi.yaml):
- POST /api/auth/signup
- POST /api/auth/login
- POST /api/auth/logout
- GET /api/auth/me
- GET /api/user/preferences
- PUT /api/user/preferences

**Error Handling**:
- If DB connection fails: Log error, return 503 Service Unavailable
- If query fails: Rollback transaction, return 500
- If validation fails: Return 400 with specific field errors

**Deliverables**:
- [ ] backend/db/schema.sql executed on Neon
- [ ] backend/db/connection.py with pooling
- [ ] backend/app/main.py with all auth routes
- [ ] Environment variables configured (.env.example)

**Commit**: `Subagent [NeonSchemaAgent]: Create Neon PostgreSQL schema`
**Commit**: `Subagent [APIRoutesAgent]: Implement FastAPI auth and user endpoints`

---

### Phase 8: Personalization Tips Based on Level

**Goal**: Build personalized tips overlay that shows level-appropriate content.

**Subagents**:
21. **PersonalizeTipsAgent**: Build tips overlay component with level-based content

**Tips Content by Level**:

**Beginner**:
- "Start with the basics - don't skip chapters!"
- "Try the activities even if they seem simple"
- "The glossary at the end of each chapter helps with terminology"

**Intermediate**:
- "Challenge yourself with the advanced code examples"
- "Try modifying the activity projects"
- "Connect concepts across chapters"

**Advanced**:
- "Explore the research papers linked in Part 4"
- "Consider contributing improvements to the activities"
- "Apply concepts to your own hardware projects"

**Hardware-Specific Tips**:
- If user has Arduino: "Your Arduino is perfect for Chapter 2 activities!"
- If user has Raspberry Pi: "Use your Pi for the vision system exercises"

**Error Handling**:
- If level not set: Default to Beginner
- If API fails: Show cached/default tips
- If overlay doesn't close: Add multiple close mechanisms (X button, outside click, Escape key)

**Deliverables**:
- [ ] src/components/PersonalizeTips.tsx
- [ ] Tips content for all three levels
- [ ] Hardware-aware tip generation
- [ ] Glassmorphism overlay styling

**Commit**: `Subagent [PersonalizeTipsAgent]: Build personalized tips overlay`

---

### Phase 9: ChatKit RAG Bot with Text Selection

**Goal**: Implement the AI-powered Q&A chatbot using RAG on textbook content.

**Subagents**:
22. **ChatKitUIAgent**: Build floating chat panel with text selection support
23. **RAGIndexAgent**: Index all lesson content in Qdrant
24. **ChatKitBackendAgent**: Implement RAG query endpoint

**ChatKit Features**:
1. Floating button (bottom-right corner)
2. Expandable chat panel
3. Text selection ‚Üí auto-populates input
4. "AI Robotics Guide" as bot name
5. Sources shown with responses
6. Rate limiting (10 queries/minute)

**RAG Pipeline**:
1. Index: Split lessons into chunks ‚Üí embed with text-embedding-3-small ‚Üí store in Qdrant
2. Query: Embed user question ‚Üí find top 5 similar chunks ‚Üí send to GPT-4o-mini with context
3. Response: Return answer with source citations

**Error Handling**:
- If Qdrant unavailable: Show "AI assistant temporarily unavailable" toast
- If OpenAI rate limited: Queue request, show loading state
- If response takes >10s: Show timeout message, offer retry
- If question off-topic: Return polite "outside textbook scope" message

**Deliverables**:
- [ ] src/components/ChatKitPanel.tsx
- [ ] Text selection event handler
- [ ] Qdrant collection with all lessons indexed
- [ ] backend/app/chat.py with RAG logic
- [ ] POST /api/chat/sessions and POST /api/chat/sessions/{id}/messages endpoints

**Commit**: `Subagent [ChatKitUIAgent]: Build ChatKit floating panel`
**Commit**: `Subagent [RAGIndexAgent]: Index textbook content in Qdrant`
**Commit**: `Subagent [ChatKitBackendAgent]: Implement RAG query backend`

---

### Phase 10: Final Testing + Vercel Deploy

**Goal**: Comprehensive testing and deployment to Vercel.

**Subagents**:
25. **TestingAgent**: Write and run all tests
26. **DeployAgent**: Configure and deploy to Vercel

**Testing Checklist**:
- [ ] All 97+ lessons render without errors
- [ ] All 30+ diagrams display with alt text
- [ ] Navigation links work (no broken links)
- [ ] Signup/login flow works
- [ ] Premium features gated correctly
- [ ] Toast notifications appear for unauthenticated access
- [ ] Urdu translation displays with RTL
- [ ] ChatKit responds with relevant answers
- [ ] Personalized tips show correct level content
- [ ] Mobile responsive on all breakpoints
- [ ] Lighthouse score >80
- [ ] Zero console errors

**Vercel Configuration**:
```json
// vercel.json
{
  "buildCommand": "cd textbook && pnpm build",
  "outputDirectory": "textbook/build",
  "functions": {
    "api/*.py": {
      "runtime": "python3.11"
    }
  }
}
```

**Environment Variables for Vercel**:
- `DATABASE_URL`: Neon connection string
- `JWT_SECRET`: Random secret for JWT signing
- `OPENAI_API_KEY`: OpenAI API key
- `QDRANT_URL`: Qdrant cloud URL
- `QDRANT_API_KEY`: Qdrant API key

**Error Handling**:
- If build fails: Check logs, fix incrementally
- If tests fail: Fix issues before deploy
- If Vercel deploy fails: Check function logs, verify env vars
- If links broken: Run link checker, update references

**Deliverables**:
- [ ] Playwright E2E tests passing
- [ ] Pytest backend tests passing
- [ ] Link checker validation passing
- [ ] Lighthouse audit >80
- [ ] Successful Vercel deployment
- [ ] Demo video (<90 seconds)

**Commit**: `Subagent [TestingAgent]: Add comprehensive tests`
**Commit**: `Subagent [DeployAgent]: Configure and deploy to Vercel`

---

## Subagent Summary

| # | Subagent Name | Phase | Primary Responsibility |
|---|---------------|-------|------------------------|
| 1 | DocusaurusSetupAgent | 1 | Initialize Docusaurus 3.5.2 |
| 2 | TailwindConfigAgent | 1 | Configure Tailwind CSS |
| 3 | ProjectStructureAgent | 1 | Create folder structure |
| 4 | CoverImageAgent | 2 | Generate book cover |
| 5 | LogoAgent | 2 | Generate logo/favicon |
| 6 | DiagramAgent | 2 | Generate 30+ diagrams |
| 7 | Part1ContentAgent | 3 | Generate Part 1 (20 lessons) |
| 8 | Part2ContentAgent | 3 | Generate Part 2 (24 lessons) |
| 9 | Part3ContentAgent | 3 | Generate Part 3 (25 lessons) |
| 10 | Part4ContentAgent | 3 | Generate Part 4 (28 lessons) |
| 11 | MCQAgent | 3 | Generate all MCQs |
| 12 | UrduTranslationAgent | 4 | Translate to Urdu |
| 13 | RTLConfigAgent | 4 | Configure RTL/font |
| 14 | NavbarAgent | 5 | Build responsive navbar |
| 15 | FooterAgent | 5 | Build responsive footer |
| 16 | SignupPageAgent | 6 | Create signup page |
| 17 | LoginPageAgent | 6 | Create login page |
| 18 | AuthContextAgent | 6 | Implement auth context |
| 19 | NeonSchemaAgent | 7 | Create database schema |
| 20 | APIRoutesAgent | 7 | Implement API endpoints |
| 21 | PersonalizeTipsAgent | 8 | Build tips overlay |
| 22 | ChatKitUIAgent | 9 | Build chat panel UI |
| 23 | RAGIndexAgent | 9 | Index content in Qdrant |
| 24 | ChatKitBackendAgent | 9 | Implement RAG backend |
| 25 | TestingAgent | 10 | Write and run tests |
| 26 | DeployAgent | 10 | Deploy to Vercel |

**Total Subagents: 26** (exceeds minimum requirement of 25)

## Complexity Tracking

> **No Constitution violations - all principles satisfied**

| Consideration | Decision | Justification |
|--------------|----------|---------------|
| Tailwind CSS | Allowed | Constitution permits "Docusaurus-compatible integration" |
| FastAPI backend | Required | Needed for auth and ChatKit API |
| Qdrant vector DB | Required | Needed for RAG functionality |
| External APIs (OpenAI) | Allowed | Required for ChatKit AI responses |

## Risk Assessment

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Content generation quality | Medium | High | Review samples before bulk generation |
| Urdu translation accuracy | Medium | Medium | Manual spot-check critical sections |
| ChatKit response relevance | Medium | Medium | Tune RAG parameters, add feedback |
| Build time for 100+ pages | High | Low | Generate incrementally, cache builds |
| API rate limits (OpenAI) | Medium | Medium | Implement queuing, rate limiting |

## Next Steps

1. Run `/sp.tasks` to generate detailed task list from this plan
2. Begin Phase 1 implementation with DocusaurusSetupAgent
3. Track subagent commits in git history
